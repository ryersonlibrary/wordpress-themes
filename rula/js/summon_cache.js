

var en = {"Check Availability":"Check Availability","more options":"more options","Your query has been truncated.":"Your query has been truncated.","Item successfully sent to %{email}":"Item successfully sent to %{email}","Within this issue":"Within this issue","Date(oldest)":"Date(oldest)","newest":"newest","May":"May","Oct":"Oct","Report":"Report","Related books from other libraries":"Related books from other libraries","Very likely":"Very likely","With these terms":"With these terms","Saved Items":"Saved Items","Dates published from":"Dates published from","Written/created by":"Written/created by","Standard":"Standard","Journal":"Journal","Powered by":"Powered by","by":"by","Thesis / Dissertation":"Thesis / Dissertation","Issue":"Issue","Your email was sent":"Your email was sent","Search Results Format":"Search Results Format","Newspaper":"Newspaper","Publication Date":"Publication Date","Publication Title":"Publication Title","BibTeX":"BibTeX","Book Review":"Book Review","Region":"Region","AMA":"AMA","Library":"Library Location","Remove":"Remove","Definitely":"Definitely","Add results beyond your library's collection":"Add results beyond your library's collection","e.g. Journal Of Endocrinology":"e.g. Journal Of Endocrinology","Suggestions":"Suggestions","Enter a valid date range":"Enter a valid date range","mostly print and physical material":"mostly print and physical material","Your feedback has been sent. Thank you!":"Your feedback has been sent. Thank you!","Notes":"Notes","Simplified Chinese":"Simplified Chinese","Easily discover the world of library content":"Easily discover the world of library content","Scholarly materials, including peer-reviewed":"Scholarly materials, including peer-reviewed","Sort by":"Sort by","Content Type":"Content Type","Click here for more information":"Click here for more information","Aug":"Aug","Go back to your previous search, and try different filters.":"Go back to your previous search, and try different filters.","Facet Name":"Facet Name","ISBN":"ISBN","Close":"Close","Sorry. Your session has timed out.":"Sorry. Your session has timed out.","APA":"APA","Dec":"Dec","Clear Folder":"Clear Folder","German":"German","Exclude Newspaper Articles":"Exclude Newspaper Articles","Gov Doc Num":"Gov Doc Num","Include results from outside your library's collection":"Include results from outside your library's collection","Series":"Series","Music Score":"Music Score","Audio Recording":"Audio Recording","Print":"Print","EndNote":"EndNote","optional":"optional","English":"English","issue":"issue","Preview":"Preview","Volume":"Volume","Advisor":"Advisor","Call Num":"Call Num","Limit to articles from scholarly publications, including peer-review":"Limit to articles from scholarly publications, including peer-review","%{page_size} of %{x} results for %{search_results}":"%{page_size} of %{x} results for %{search_results}","Language":"Language","Chicago/Turabian":"Chicago/Turabian","to":"to","Back":"Back","oldest":"oldest","Items in the library catalog":"Items in the library catalog","Send Email":"Send Email","Category":"Category","Email":"Email","Refine your search":"Refine your search","Journal Article":"Journal Article","Book reviews":"Book reviews","You can add results to this folder by clicking the 'save this item' icon from the upper right of every search result. Any saved items will be available for the duration of your search session. If you would like to save your items beyond the session, you can copy/paste, email, print, or export your list to bibliographic management software at any time.":"You can add results to this folder by clicking the 'save this item' icon from the upper right of every search result. Any saved items will be available for the duration of your search session. If you would like to save your items beyond the session, you can copy/paste, email, print, or export your list to bibliographic management software at any time.","Never":"Never","Finnish":"Finnish","Mobile":"Mobile","e.g. Fitzgerald":"e.g. Fitzgerald","Search is temporarily unavailable":"Search is temporarily unavailable","Microfilm":"Microfilm","Traditional Chinese":"Traditional Chinese","Japanese":"Japanese","Image":"Image","Oops! There was a problem":"Oops! There was a problem","Abstract":"Abstract","Newspaper articles":"Newspaper articles","Your query must be less than 1000 characters.":"Your query must be less than 1000 characters.","save this item":"save this item","Image (if any)":"Image (if any)","Results powered by Summon\u2122 from Serials Solutions, a division of ProQuest.":"Results powered by Summon\u2122 from Serials Solutions, a division of ProQuest.","You currently have no saved items":"You currently have no saved items","eBook":"eBook","Feedback":"Feedback","Full Text Online":"Full Text Online","see a preview of this item":"see a preview of this item","Make sure all words are spelled correctly.":"Make sure all words are spelled correctly.","Next":"Next","Search":"Search","Updating Results":"Updating Results","Type (e.g. book, journal article, etc.)":"Type (e.g. book, journal article, etc.)","Web Resource":"Web Resource","Times Cited":"Times Cited","Send":"Send","This is a temporary folder, your saved items will be cleared when you leave. You can export, email, or print your saved items at any time.":"This is a temporary folder, your saved items will be cleared when you leave. You can export, email, or print your saved items at any time.","and Issue":"and Issue","Government Document Classification Number":"Government Document Classification Number","American Medical Assoc.":"American Medical Assoc.","Reset Form":"Reset Form","Please select at least 1 item for display.":"Please select at least 1 item for display.","Search Library":"Search Library","Oops! There was an unexpected error while we were submitting your feedback.":"Oops! There was an unexpected error while we were submitting your feedback.","Swedish":"Swedish","Icelandic":"Icelandic","Exclude":"Exclude","Subjects":"Subjects","Call Number":"Call Number","Clear":"Clear","Start Page":"Start Page","Print current search results":"Print current search results","Off Campus? Log in to access full text and more content.":"Off Campus? Log in to access full text and more content.","Include":"Include","Newspaper Article":"Newspaper Article","Jul":"Jul","RSS 2.0 feed for current search":"RSS 2.0 feed for current search","Your search for %{search_results} returned %{x} results":"Your search for %{search_results} returned %{x} results","Invalid sort order.":"Invalid sort order.","Jun":"Jun","The boolean format used is invalid.":"The boolean format used is invalid.","show 1 more copy":"show 1 more copy","Recommendation: We found one or more specialized collections that might help you":"Recommendation: We found one or more specialized collections that might help you","publication":"publication","Try fewer keywords.":"Try fewer keywords.","There was a problem.":"There was a problem.","Book Chapter":"Book Chapter","returned":"returned","List":"List","Basic Search":"Basic Search","drag this item to your saved items folder":"drag this item to your saved items folder","Enter a valid year":"Enter a valid year","Book":"Book","Portuguese":"Portuguese","Date":"Date","Any Format":"Any Format","Video Recording":"Video Recording","Advanced":"Advanced","address":"address","Genre":"Genre","Make all the fields in the advanced search blank":"Make all the fields in the advanced search blank","Email List":"Email List","Update":"Update","Written by this author":"Written by this author","Try more general keywords.":"Try more general keywords.","Excluded":"Excluded","Harvard":"Harvard","Please choose one of the following":"Please choose one of the following","before #year#":"before %{year}","show":"show","Any":"Any","Vol":"Vol","You have %{n} of 1000 characters remaining.":"You have %{n} of 1000 characters remaining.","Maybe":"Maybe","Exclude from results":"Exclude from results","error":"error","Norwegian":"Norwegian","%{email_address} is not a valid email address":"%{email_address} is not a valid email address","Email Address":"Email Address","Date(newest)":"Date(newest)","Didn't find what I was looking for":"Didn't find what I was looking for","email to":"to","No more results":"No more results","Dutch":"Dutch","Did you mean":"Did you mean","DOI":"DOI","results":"results","Clear Form":"Clear Form","Not very likely":"Not very likely","New search":"New search","author":"author","format":"format","Show with this format":"Show with this format","Cancel":"Cancel","Availability":"Availability","Degree Date":"Degree Date","Author-Date":"Author-Date","Danish":"Danish","more":"more","Note This list of saved items may not persist on your phone after you exit the application.":"Note This list of saved items may not persist on your phone after you exit the application.","Manuscript":"Manuscript","Prev":"Prev","Photograph":"Photograph","Corporate Authors":"Corporate Authors","MLA":"MLA","Within this volume":"Within this volume","See if there are results beyond your library's collection":"See if there are results beyond your library's collection","Sep":"Sep","French":"French","Your feedback must be less than 1000 characters.":"Your feedback must be less than 1000 characters.","Jan":"Jan","Modern Language Association":"Modern Language Association","and":"and","Dissertation":"Dissertation","Try different keywords.":"Try different keywords.","Corporate Author":"Corporate Author","to present":"to present","Publisher":"Publisher","Open Advanced Search":"Open Advanced Search","loading":"loading","Government Document":"Government Document","American Psychological Assoc.":"American Psychological Assoc.","Italian":"Italian","Uniform":"Uniform","Advanced Search":"Advanced Search","Show Only":"Show Only","Pages":"Pages","From this publication":"From this publication","Degree":"Degree","Archival Material":"Archival Material","Ok":"Ok","Expand your results":"Expand your results","Author":"Author","Special Collection":"Special Collection","show %{n} more copies":"show %{n} more copies","remove this item":"remove this item","Subject Terms":"Subject Terms","ISSN":"ISSN","Keep search refinements":"Keep search refinements","Results per page":"Results per page","Institution":"Institution","Thesis/Dissertation":"Thesis/Dissertation","e.g. The Great Gatsby":"e.g. The Great Gatsby","About":"About","Report a problem or bug":"Report a problem or bug","Time Period":"Time Period","Music Recording":"Music Recording","The number format used is invalid.":"The number format used is invalid.","Description":"Description","Map":"Map","Items successfully sent to %{email}":"Items successfully sent to %{email}","Link didn't work as expected":"Link didn't work as expected","Items with full text online":"Items with full text online","Reset all search parameters to their original values":"Reset all search parameters to their original values","Terms & Conditions":"Terms & Conditions","Patent":"Patent","Feb":"Feb","Spanish":"Spanish","Apr":"Apr","Request a new feature":"Request a new feature","Mar":"Mar","Edition":"Edition","General Feedback":"General Feedback","Search Results":"Search Results","Relevance":"Relevance","Help":"Help","Nov":"Nov","With these words in the title":"With these words in the title","couldn't find document":"couldn't find document","Type of feedback:":"Type of feedback:","Saved Item":"Saved Item","Patent Number":"Patent Number","How likely would you be to recommend this search service to a friend or colleague?":"How likely would you be to recommend this search service to a friend or colleague?","Always check your references for accuracy":"Always check your references for accuracy","RefWorks":"RefWorks","Conference Proceeding":"Conference Proceeding","Export":"Export","Are you sure you want to clear your saved items?":"Are you sure you want to clear your saved items?","Continue":"Continue","Link":"Link","We apologize for any inconvenience":"We apologize for any inconvenience","There was a problem with the way the query was formatted.":"There was a problem with the way the query was formatted.","Citation Online":"Citation Online","Dissertations":"Dissertations","There was an unexpected error that happened while performing your search. We have been notified of this issue and are working to resolve it as soon as possible":"There was an unexpected error that happened while performing your search. We have been notified of this issue and are working to resolve it as soon as possible","Computer File":"Computer File"};

;
(function(write) {
  window.log = {
    log: write('log'),
    debug: write('debug'),
    info: write('info'),
    warn: write('warn'),
    error: write('error')
  }
})(function(priority) {
  if (window.console && window.console[priority] && window.console[priority].call  ) {
    return function(message) {
      //window.console[priority].call(window.console, message)
    }
  } else {
    return function() {}    
  }
})
;

/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 * 
 * Open source under the BSD License. 
 * 
 * Copyright Â© 2008 George McGinley Smith
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
*/

// t: current time, b: begInnIng value, c: change In value, d: duration
jQuery.easing['jswing'] = jQuery.easing['swing'];

jQuery.extend( jQuery.easing,
{
	def: 'easeOutQuad',
	swing: function (x, t, b, c, d) {
		//alert(jQuery.easing.default);
		return jQuery.easing[jQuery.easing.def](x, t, b, c, d);
	},
	easeInQuad: function (x, t, b, c, d) {
		return c*(t/=d)*t + b;
	},
	easeOutQuad: function (x, t, b, c, d) {
		return -c *(t/=d)*(t-2) + b;
	},
	easeInOutQuad: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t + b;
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInCubic: function (x, t, b, c, d) {
		return c*(t/=d)*t*t + b;
	},
	easeOutCubic: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t + 1) + b;
	},
	easeInOutCubic: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t + b;
		return c/2*((t-=2)*t*t + 2) + b;
	},
	easeInQuart: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t + b;
	},
	easeOutQuart: function (x, t, b, c, d) {
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeInOutQuart: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	},
	easeInQuint: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t*t + b;
	},
	easeOutQuint: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t*t*t + 1) + b;
	},
	easeInOutQuint: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
		return c/2*((t-=2)*t*t*t*t + 2) + b;
	},
	easeInSine: function (x, t, b, c, d) {
		return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
	},
	easeOutSine: function (x, t, b, c, d) {
		return c * Math.sin(t/d * (Math.PI/2)) + b;
	},
	easeInOutSine: function (x, t, b, c, d) {
		return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
	},
	easeInExpo: function (x, t, b, c, d) {
		return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
	},
	easeOutExpo: function (x, t, b, c, d) {
		return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
	},
	easeInOutExpo: function (x, t, b, c, d) {
		if (t==0) return b;
		if (t==d) return b+c;
		if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
		return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
	},
	easeInCirc: function (x, t, b, c, d) {
		return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
	},
	easeOutCirc: function (x, t, b, c, d) {
		return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
	},
	easeInOutCirc: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
		return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
	},
	easeInElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
	},
	easeOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
	},
	easeInOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
		return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
	},
	easeInBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*(t/=d)*t*((s+1)*t - s) + b;
	},
	easeOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
	},
	easeInOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158; 
		if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
		return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
	},
	easeInBounce: function (x, t, b, c, d) {
		return c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d) + b;
	},
	easeOutBounce: function (x, t, b, c, d) {
		if ((t/=d) < (1/2.75)) {
			return c*(7.5625*t*t) + b;
		} else if (t < (2/2.75)) {
			return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
		} else if (t < (2.5/2.75)) {
			return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
		} else {
			return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
		}
	},
	easeInOutBounce: function (x, t, b, c, d) {
		if (t < d/2) return jQuery.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
		return jQuery.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
	}
});

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 * 
 * Open source under the BSD License. 
 * 
 * Copyright Â© 2001 Robert Penner
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */

/*
 * jQuery Color Animations
 * Copyright 2007 John Resig
 * Released under the MIT and GPL licenses.
 */

(function(jQuery){

	// We override the animation for all of these color styles
	jQuery.each(['backgroundColor', 'borderBottomColor', 'borderLeftColor', 'borderRightColor', 'borderTopColor', 'color', 'outlineColor'], function(i,attr){
		jQuery.fx.step[attr] = function(fx){
			if ( fx.state == 0 ) {
				fx.start = getColor( fx.elem, attr );
				fx.end = getRGB( fx.end );
			}

			fx.elem.style[attr] = "rgb(" + [
				Math.max(Math.min( parseInt((fx.pos * (fx.end[0] - fx.start[0])) + fx.start[0]), 255), 0),
				Math.max(Math.min( parseInt((fx.pos * (fx.end[1] - fx.start[1])) + fx.start[1]), 255), 0),
				Math.max(Math.min( parseInt((fx.pos * (fx.end[2] - fx.start[2])) + fx.start[2]), 255), 0)
			].join(",") + ")";
		}
	});

	// Color Conversion functions from highlightFade
	// By Blair Mitchelmore
	// http://jquery.offput.ca/highlightFade/

	// Parse strings looking for color tuples [255,255,255]
	function getRGB(color) {
		var result;

		// Check if we're already dealing with an array of colors
		if ( color && color.constructor == Array && color.length == 3 )
			return color;

		// Look for rgb(num,num,num)
		if (result = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color))
			return [parseInt(result[1]), parseInt(result[2]), parseInt(result[3])];

		// Look for rgb(num%,num%,num%)
		if (result = /rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color))
			return [parseFloat(result[1])*2.55, parseFloat(result[2])*2.55, parseFloat(result[3])*2.55];

		// Look for #a0b1c2
		if (result = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color))
			return [parseInt(result[1],16), parseInt(result[2],16), parseInt(result[3],16)];

		// Look for #fff
		if (result = /#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color))
			return [parseInt(result[1]+result[1],16), parseInt(result[2]+result[2],16), parseInt(result[3]+result[3],16)];

		// Otherwise, we're most likely dealing with a named color
		return colors[jQuery.trim(color).toLowerCase()];
	}
	
	function getColor(elem, attr) {
		var color;

		do {
			color = jQuery.curCSS(elem, attr);

			// Keep going until we find an element that has color, or we hit the body
			if ( color != '' && color != 'transparent' || jQuery.nodeName(elem, "body") )
				break; 

			attr = "backgroundColor";
		} while ( elem = elem.parentNode );

		return getRGB(color);
	};
	
	// Some named colors to work with
	// From Interface by Stefan Petre
	// http://interface.eyecon.ro/

	var colors = {
		aqua:[0,255,255],
		azure:[240,255,255],
		beige:[245,245,220],
		black:[0,0,0],
		blue:[0,0,255],
		brown:[165,42,42],
		cyan:[0,255,255],
		darkblue:[0,0,139],
		darkcyan:[0,139,139],
		darkgrey:[169,169,169],
		darkgreen:[0,100,0],
		darkkhaki:[189,183,107],
		darkmagenta:[139,0,139],
		darkolivegreen:[85,107,47],
		darkorange:[255,140,0],
		darkorchid:[153,50,204],
		darkred:[139,0,0],
		darksalmon:[233,150,122],
		darkviolet:[148,0,211],
		fuchsia:[255,0,255],
		gold:[255,215,0],
		green:[0,128,0],
		indigo:[75,0,130],
		khaki:[240,230,140],
		lightblue:[173,216,230],
		lightcyan:[224,255,255],
		lightgreen:[144,238,144],
		lightgrey:[211,211,211],
		lightpink:[255,182,193],
		lightyellow:[255,255,224],
		lime:[0,255,0],
		magenta:[255,0,255],
		maroon:[128,0,0],
		navy:[0,0,128],
		olive:[128,128,0],
		orange:[255,165,0],
		pink:[255,192,203],
		purple:[128,0,128],
		violet:[128,0,128],
		red:[255,0,0],
		silver:[192,192,192],
		white:[255,255,255],
		yellow:[255,255,0]
	};
	
})(jQuery);


/* little helper to determine which direction the browser is rendering in */

;(function($, window, undefined) {
	
function update() {
	var dir = $('html').attr('dir')
	$.bidi.rtl = (dir == 'rtl')
	$.bidi.ltr = !$.bidi.rtl
}

$.bidi = { update: update }

update()

})(jQuery, this);

;(function($, window, undefined) {

  var win = $(window)
  
  function getPos(el) {
    if (el[0] === document)
      return [0, 0]
    if (el[0] === window)
      return [win.scrollLeft(), win.scrollTop()]

    var offset = el.offset()
    return [offset.left + win.scrollLeft(), offset.top + win.scrollTop()]
  }
  
  function getWidth(el) {
    if (el[0] == document || el[0] == window)
      return el.width()
    // else
    return el.outerWidth()
  }

  function getHeight(el) {
    if (el[0] == document || el[0] == window)
      return el.height()
    // else
    return el.outerHeight()
  }

  var rtlTransform = {
    NE: 'NW',
    E:  'W',
    SE: 'SW',
    SW: 'SE',
    W:  'E',
    NW: 'NE'
  }
  function rtlSwap(places) {
    var newPlaces = {}
    for (var prop in places) {
      if (prop in rtlTransform)
        newPlaces[rtlTransform[prop]] = places[prop]
      else
        newPlaces[prop] = places[prop]
    }
    return newPlaces
  }
 
  $.fn.places = function(options) {
    var settings = {}
    if (!$.isEmptyObject($.fn.places.NAMES)) 
      settings.names = $.fn.places.NAMES
    if (options) 
      $.extend(settings, options)
    
    var el      = this,
        pos     = getPos(el),
        left    = pos[0],
        top     = pos[1],
        width   = getWidth(el),
        height  = getHeight(el),
        right   = left + width,
        bottom  = top  + height,
        hCenter = left + parseInt((right - left)/2),
        vCenter = top  + parseInt((bottom - top)/2)

    var places = {
      C:  [hCenter, vCenter],
      N:  [hCenter, top],
      NE: [right,   top],
      E:  [right,   vCenter],
      SE: [right,   bottom],
      S:  [hCenter, bottom],
      SW: [left,    bottom],
      W:  [left,    vCenter],
      NW: [left,    top]
    }

    if ('dir' in jQuery && jQuery.bidi.rtl)
      places = rtlSwap(places)

    if (settings.names) {
      var name, newName
      for (name in settings.names) {
        newName = settings.names[name]
        if (name != newName) {
          places[newName] = places[name]
          delete places[name]
        }
      }
    }

    return places
  }
  
  $.fn.places.NAMES = {}
  
})(jQuery, this);


;(function($, window, undefined) {

  var win = $(window)

  function getPos(el) {
    if (el[0] === document)
      return [0, 0]
    if (el[0] === window)
      return [win.scrollLeft(), win.scrollTop()]

    var offset = el.offset()
    return [offset.left + win.scrollLeft(), offset.top + win.scrollTop()]
  }
  
  var placeNames = {
    C:  'Center',
    N:  'North',
    NE: 'NorthEast',
    E:  'East',
    SE: 'SouthEast',
    S:  'South',
    SW: 'SouthWest',
    W:  'West',
    NW: 'NorthWest'
  }
  function getCenter(el) {
    return el.places({names:placeNames}).Center
  }

  function coordsToCss(pos) {
    return { left: pos[0], top: pos[1] }
  }

  function calcPos(coords, offset, relCenter, otherPlace, options) {
    var options = options || {}
    var oCenter = otherPlace.center,
        oCoords = otherPlace.coordinates,
        relative = [offset[0] - coords[0], offset[1] - coords[1]], // relative offset of place to topleft
        position = [oCoords[0] + relative[0], oCoords[1] + relative[1]],
        displace = [0, 0],
        center = [position[0] + relCenter[0] - offset[0], position[1] + relCenter[1] - offset[1]]

    if ('horizontal' in options) displace[0] = options.horizontal
    if ('vertical' in options) displace[1] = options.vertical
    if (center[0] < oCenter[0]) displace[0] *= -1
    if (center[1] < oCenter[1]) displace[1] *= -1

    return [position[0] + displace[0], position[1] + displace[1]]
  }
  
  function placify(el) {
    var elem = $(el),
        places = elem.places(),
        center = getCenter(elem),
        offset = getPos(elem),
        props = {}
    for (var prop in places) {
      (function(coords) {
        props[prop] = {
          offset: offset,
          center: center,
          coordinates: coords,
          placeAt: function(otherPlace, options) {
            var pos = calcPos(coords, offset, center, otherPlace, options)
            if (options && options.animate)
              elem.animate(coordsToCss(pos), options.animate)
            else
              elem.css(coordsToCss(pos))
            return elem
          }
        }
      })(places[prop])
    }
    return props
  }
  
  $.fn.place = function(other, block) {
    block(placify(this), placify(other))
    return this
  }  
  
})(jQuery, this);


/**
 * Copyright (c) 2005 - 2009, James Auldridge
 * All rights reserved.
 *
 * Licensed under the BSD, MIT, and GPL (your choice!) Licenses:
 *  http://code.google.com/p/cookies/wiki/License
 *
 */
var jaaulde = window.jaaulde || {};
jaaulde.utils = jaaulde.utils || {};
jaaulde.utils.cookies = ( function()
{
	var cookies = [];

	var defaultOptions = {
		hoursToLive: null,
		path: '/',
		domain:  null,
		secure: false
	};
	/**
	 * resolveOptions - receive an options object and ensure all options are present and valid, replacing with defaults where necessary
	 *
	 * @access private
	 * @static
	 * @parameter Object options - optional options to start with
	 * @return Object complete and valid options object
	 */
	var resolveOptions = function( options )
	{
		var returnValue;

		if( typeof options !== 'object' || options === null )
		{
			returnValue = defaultOptions;
		}
		else
		{
			returnValue = {
				hoursToLive: ( typeof options.hoursToLive === 'number' && options.hoursToLive !== 0 ? options.hoursToLive : defaultOptions.hoursToLive ),
				path: ( typeof options.path === 'string' && options.path !== '' ? options.path : defaultOptions.path ),
				domain: ( typeof options.domain === 'string' && options.domain !== '' ? options.domain : defaultOptions.domain ),
				secure: ( typeof options.secure === 'boolean' && options.secure ? options.secure : defaultOptions.secure )
			};
		}

		return returnValue;
	};
	/**
	 * expiresGMTString - add given number of hours to current date/time and convert to GMT string
	 *
	 * @access private
	 * @static
	 * @parameter Integer hoursToLive - number of hours for which cookie should be valid
	 * @return String - GMT time representing current date/time plus number of hours given
	 */
	var expiresGMTString = function( hoursToLive )
	{
		var dateObject = new Date();
		dateObject.setTime( dateObject.getTime() + ( hoursToLive * 60 * 60 * 1000 ) );

		return dateObject.toGMTString();
	};
	/**
	 * assembleOptionsString - analyze options and assemble appropriate string for setting a cookie with those options
	 *
	 * @access private
	 * @static
	 * @parameter Object options - optional options to start with
	 * @return String - complete and valid cookie setting options
	 */
	var assembleOptionsString = function( options )
	{
		options = resolveOptions( options );

		return (
			( typeof options.hoursToLive === 'number' ? '; expires=' + expiresGMTString( options.hoursToLive ) : '' ) +
			'; path=' + options.path +
			( typeof options.domain === 'string' ? '; domain=' + options.domain : '' ) +
			( options.secure === true ? '; secure' : '' )
		);
	};
	/**
	 * splitCookies - retrieve document.cookie string and break it into a hash
	 *
	 * @access private
	 * @static
	 * @return Object - hash of cookies from document.cookie
	 */
	var splitCookies = function()
	{
		cookies = {};
		var pair, name, value, separated = document.cookie.split( ';' );
		for( var i = 0; i < separated.length; i = i + 1 )
		{
			pair = separated[i].split( '=' );
			name = pair[0].replace( /^\s*/, '' ).replace( /\s*$/, '' );
			value = decodeURIComponent( pair[1] );
			cookies[name] = value;
		}
		return cookies;
	};

	var constructor = function(){};
	
	/**
	 * get - get one, several, or all cookies
	 *
	 * @access public
	 * @paramater Mixed cookieName - String:name of single cookie; Array:list of multiple cookie names; Void (no param):if you want all cookies
	 * @return Mixed - String:if single cookie requested and found; Null:if single cookie requested and not found; Object:hash of multiple or all cookies
	 */
	constructor.prototype.get = function( cookieName )
	{
		var returnValue;
		
		splitCookies();

		if( typeof cookieName === 'string' )
		{
			returnValue = ( typeof cookies[cookieName] !== 'undefined' ) ? cookies[cookieName] : null;
		}
		else if( typeof cookieName === 'object' && cookieName !== null )
		{
			returnValue = {};
			for( var item in cookieName )
			{
				if( typeof cookies[cookieName[item]] !== 'undefined' )
				{
					returnValue[cookieName[item]] = cookies[cookieName[item]];
				}
				else
				{
					returnValue[cookieName[item]] = null;
				}
			}
		}
		else
		{
			returnValue = cookies;
		}

		return returnValue;
	};
	/**
	 * filter - get array of cookies whose names match the provided RegExp
	 *
	 * @access public
	 * @paramater Object RegExp - The regular expression to match against cookie names
	 * @return Mixed - Object:hash of cookies whose names match the RegExp
	 */
	constructor.prototype.filter = function( cookieNameRegExp )
	{
		var returnValue = {};

		splitCookies();

		if( typeof cookieNameRegExp === 'string' )
		{
			cookieNameRegExp = new RegExp( cookieNameRegExp );
		}

		for( var cookieName in cookies )
		{
			if( cookieName.match( cookieNameRegExp ) )
			{
				returnValue[cookieName] = cookies[cookieName];
			}
		}

		return returnValue;
	};
	/**
	 * set - set or delete a cookie with desired options
	 *
	 * @access public
	 * @paramater String cookieName - name of cookie to set
	 * @paramater Mixed value - Null:if deleting, String:value to assign cookie if setting
	 * @paramater Object options - optional list of cookie options to specify (hoursToLive, path, domain, secure)
	 * @return void
	 */
	constructor.prototype.set = function( cookieName, value, options )
	{
		if( typeof value === 'undefined' || value === null )
		{
			if( typeof options !== 'object' || options === null )
			{
				options = {};
			}
			value = '';
			options.hoursToLive = -8760;
		}
		
		var optionsString = assembleOptionsString( options );

		document.cookie = cookieName + '=' + encodeURIComponent( value ) + optionsString;
	};
	/**
	 * del - delete a cookie (domain and path options must match those with which the cookie was set; this is really an alias for set() with parameters simplified for this use)
	 *
	 * @access public
	 * @paramater MIxed cookieName - String name of cookie to delete, or Bool true to delete all
	 * @paramater Object options - optional list of cookie options to specify ( path, domain )
	 * @return void
	 */
	constructor.prototype.del = function( cookieName, options )
	{
		var allCookies = {};

		if( typeof options !== 'object' || options === null )
		{
			options = {};
		}

		if( typeof cookieName === 'boolean' && cookieName === true )
		{
			allCookies = this.get();
		}
		else if( typeof cookieName === 'string' )
		{
			allCookies[cookieName] = true;
		}

		for( var name in allCookies )
		{
			if( typeof name === 'string' && name !== '' )
			{
				this.set( name, null, options );
			}
		}
	};
	/**
	 * test - test whether the browser is accepting cookies
	 *
	 * @access public
	 * @return Boolean
	 */
	constructor.prototype.test = function()
	{
		var returnValue = false, testName = 'cT', testValue = 'data';

		this.set( testName, testValue );

		if( this.get( testName ) === testValue )
		{
			this.del( testName );
			returnValue = true;
		}

		return returnValue;
	};
	/**
	 * setOptions - set default options for calls to cookie methods
	 *
	 * @access public
	 * @param Object options - list of cookie options to specify (hoursToLive, path, domain, secure)
	 * @return void
	 */
	constructor.prototype.setOptions = function( options )
	{
		if( typeof options !== 'object' )
		{
			options = null;
		}

		defaultOptions = resolveOptions( options );
	};

	return new constructor();
} )();

( function()
{
	if( window.jQuery )
	{
		( function( $ )
		{
			$.cookies = jaaulde.utils.cookies;

			var extensions = {
				/**
				 * $( 'selector' ).cookify - set the value of an input field or the innerHTML of an element to a cookie by the name or id of the field or element
				 *                           (radio and checkbox not yet supported)
				 *                           (field or element MUST have name or id attribute)
				 *
				 * @access public
				 * @param Object options - list of cookie options to specify
				 * @return Object jQuery
				 */
				cookify: function( options )
				{
					return this.each( function()
					{
						var i, resolvedName = false, resolvedValue = false, name = '', value = '', nameAttrs = ['name', 'id'], nodeName, inputType;

						for( i in nameAttrs )
						{
							if( ! isNaN( i ) )
							{
								name = $( this ).attr( nameAttrs[ i ] );
								if( typeof name === 'string' && name !== '' )
								{
									resolvedName = true;
									break;
								}
							}
						}

						if( resolvedName )
						{
							nodeName = this.nodeName.toLowerCase();
							if( nodeName !== 'input' && nodeName !== 'textarea' && nodeName !== 'select' && nodeName !== 'img' )
							{
								value = $( this ).html();
								resolvedValue = true;
							}
							else
							{
								inputType = $( this ).attr( 'type' );
								if( typeof inputType === 'string' && inputType !== '' )
								{
									inputType = inputType.toLowerCase();
								}
								if( inputType !== 'radio' && inputType !== 'checkbox' )
								{
									value = $( this ).val();
									resolvedValue = true;
								}
							}
							
							if( resolvedValue )
							{
								if( typeof value !== 'string' || value === '' )
								{
									value = null;
								}
								$.cookies.set( name, value, options );
							}
						}
					} );
				},
				/**
				 * $( 'selector' ).cookieFill - set the value of an input field or the innerHTML of an element from a cookie by the name or id of the field or element
				 *
				 * @access public
				 * @return Object jQuery
				 */
				cookieFill: function()
				{
					return this.each( function()
					{
						var i, resolvedName = false, name = '', value, nameAttrs = ['name', 'id'], iteration = 0, nodeName;

						for( i in nameAttrs )
						{
							if( ! isNaN( i ) )
							{
								name = $( this ).attr( nameAttrs[ i ] );
								if( typeof name === 'string' && name !== '' )
								{
									resolvedName = true;
									break;
								}
							}
						}

						if( resolvedName )
						{
							value = $.cookies.get( name );
							if( value !== null )
							{
								nodeName = this.nodeName.toLowerCase();
								if( nodeName === 'input' || nodeName === 'textarea' || nodeName === 'select' )
								{
								    $( this ).val( value );
								}
								else
								{
									$( this ).html( value );
								}
							}
						}

						iteration = 0;
					} );
				},
				/**
				 * $( 'selector' ).cookieBind - call cookie fill on matching elements, and bind their change events to cookify()
				 *
				 * @access public
				 * @param Object options - list of cookie options to specify
				 * @return Object jQuery
				 */
				cookieBind: function( options )
				{
					return this.each( function()
					{
						$( this ).cookieFill().change( function()
						{
							$( this ).cookify( options );
						} );
					} );
				}
			};

			$.each( extensions, function( i )
			{
				$.fn[i] = this;
			} );

		} )( window.jQuery );
	}
} )();

(function() {

	function append(level, msg){
		if (typeof log != 'undefined') {
			var fn = log[level]
			return fn.call(log, msg)
		}
	}

	function debug(msg) {
		append('debug', msg)
	}

	function info(msg) {
		append('info', msg)
	}

	function warn(msg) {
		append('warn', msg)
	}

	function SureGrow(element, options) {
		options = options || {}
		var animate = options.animate
		var maxlines = new Number(options.maxlines)
		var easing = options.easing || 'easeOutBounce'
		var easingExpand = options.easingExpand || easing
		var easingCollapse = options.easingCollapse || easing
		var textarea = jQuery(element).css({
			overflow: 'hidden'
		})
		var shadow = document.createElement('textarea')
		jQuery(shadow).css({
			position: 'absolute',
			top: "-200%",
			fontFamily: textarea.css('fontFamily'),
			fontSize: textarea.css('fontSize'),
			fontVariant: textarea.css('fontVariant'),
			fontWeight: textarea.css('fontWeight'),
			fontStyle: textarea.css('fontStyle'),
			height: "2px",
			width: textarea.innerWidth(),
			padding: 0,
			overflowY: 'scroll'
		}).prependTo(document.body)

		//for Windows based toolkits, adjust the width to account for encroaching scrollbars
		setTimeout(function() {
			jQuery(shadow).width(jQuery(shadow).innerWidth() * 2 - shadow.scrollWidth)
//			debug('adjusted scrollWidth: ' + shadow.scrollWidth)
		})


		var currentHeight = null
		function sync(now) {
			if (!animate) {
				now = true
			}
			shadow.value = textarea.val()
			var height = Math.round(shadow.scrollHeight)
			if (height != currentHeight) {
				var lineHeight = new Number(jQuery(shadow).css('lineHeight').slice(0,2))
				var lines = (height / lineHeight);
//				debug('height: ' + currentHeight + " -> " + height + ": " + lines + " lines.")
				if (maxlines && lines > maxlines) {
					var maxHeight = lineHeight * maxlines;
//					debug('maxheight: ' + maxHeight)
					if (currentHeight < maxHeight) {
						textarea.height(maxHeight)
						currentHeight = maxHeight
						setTimeout(function () {
							textarea.focus()
						}, 0)
					}
					textarea.css('overflowY', 'auto')
				} else if (height != 0) {
					sizeTo(height, now)
				} else {
					sizeTo(15, now)
				}
			}
		}

		function sizeTo(height, now) {
			textarea.css('overflowY', 'hidden')
//			debug('sizeTo(' + height + ', ' + now + ')')
			if (now) {
				textarea.height(height)
				textarea.focus()
				currentHeight = height
			} else {
				var easingFunction = height > currentHeight ? easingExpand : easingCollapse
				currentHeight = height
				textarea.stop(true).animate({height: height}, 300, easingFunction).queue(function() {
					textarea.focus()
					$(this).dequeue()
				})
			}
		}

		textarea.keyup(function() {
			sync(jQuery.browser.msie) //forgo animations in IE
		})

		sync(true)
		info('textarea[@id=' + textarea.attr('id') + '].suregrow({maxlines: ' + maxlines + '})')
	}


	jQuery.fn.extend({
		suregrow: function(options) {
			log.info('SureGrow 1.0  ENV ->' + jQuery.browser.version)
			return this.each(function() {
				var text = this
				if (text.tagName == 'TEXTAREA' || text.tagName == 'textarea') {
					var browser = jQuery.browser
					if (browser.mozilla) {
						SureGrow(text, options)
					} else {
						info('suregrow disabled for ' + name + " " + jQuery.browser.version)
					}
				} else {
					warn('cannot suregrow element ' + this.tagName)
				}
			})
		}
	});
})();
/**
* hoverIntent is similar to jQuery's built-in "hover" function except that
* instead of firing the onMouseOver event immediately, hoverIntent checks
* to see if the user's mouse has slowed down (beneath the sensitivity
* threshold) before firing the onMouseOver event.
* 
* hoverIntent r5 // 2007.03.27 // jQuery 1.1.2+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* hoverIntent is currently available for use in all personal or commercial 
* projects under both MIT and GPL licenses. This means that you can choose 
* the license that best suits your project, and use it accordingly.
* 
* // basic usage (just like .hover) receives onMouseOver and onMouseOut functions
* $("ul li").hoverIntent( showNav , hideNav );
* 
* // advanced usage receives configuration object only
* $("ul li").hoverIntent({
*	sensitivity: 7, // number = sensitivity threshold (must be 1 or higher)
*	interval: 100,   // number = milliseconds of polling interval
*	over: showNav,  // function = onMouseOver callback (required)
*	timeout: 0,   // number = milliseconds delay before onMouseOut function call
*	out: hideNav    // function = onMouseOut callback (required)
* });
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne <brian@cherne.net>
*/
(function($) {
	$.fn.hoverIntent = function(f,g) {
		// default configuration options
		var cfg = {
			sensitivity: 7,
			interval: 100,
			timeout: 0
		};
		// override configuration options with user supplied object
		cfg = $.extend(cfg, g ? { over: f, out: g } : f );

		// instantiate variables
		// cX, cY = current X and Y position of mouse, updated by mousemove event
		// pX, pY = previous X and Y position of mouse, set by mouseover and polling interval
		var cX, cY, pX, pY;

		// A private function for getting mouse position
		var track = function(ev) {
			cX = ev.pageX;
			cY = ev.pageY;
		};

		// A private function for comparing current and previous mouse position
		var compare = function(ev,ob) {
			ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
			// compare mouse positions to see if they've crossed the threshold
			if ( ( Math.abs(pX-cX) + Math.abs(pY-cY) ) < cfg.sensitivity ) {
				$(ob).unbind("mousemove",track);
				// set hoverIntent state to true (so mouseOut can be called)
				ob.hoverIntent_s = 1;
				return cfg.over.apply(ob,[ev]);
			} else {
				// set previous coordinates for next time
				pX = cX; pY = cY;
				// use self-calling timeout, guarantees intervals are spaced out properly (avoids JavaScript timer bugs)
				ob.hoverIntent_t = setTimeout( function(){compare(ev, ob);} , cfg.interval );
			}
		};

		// A private function for delaying the mouseOut function
		var delay = function(ev,ob) {
			ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
			ob.hoverIntent_s = 0;
			return cfg.out.apply(ob,[ev]);
		};

		// A private function for handling mouse 'hovering'
		var handleHover = function(e) {
			// next three lines copied from jQuery.hover, ignore children onMouseOver/onMouseOut
			var p = (e.type == "mouseover" ? e.fromElement : e.toElement) || e.relatedTarget;
			while ( p && p != this ) { try { p = p.parentNode; } catch(e) { p = this; } }
			if ( p == this ) { return false; }

			// copy objects to be passed into t (required for event object to be passed in IE)
			var ev = jQuery.extend({},e);
			var ob = this;

			// cancel hoverIntent timer if it exists
			if (ob.hoverIntent_t) { ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t); }

			// else e.type == "onmouseover"
			if (e.type == "mouseover") {
				// set "previous" X and Y position based on initial entry point
				pX = ev.pageX; pY = ev.pageY;
				// update "current" X and Y position based on mousemove
				$(ob).bind("mousemove",track);
				// start polling interval (self-calling timeout) to compare mouse coordinates over time
				if (ob.hoverIntent_s != 1) { ob.hoverIntent_t = setTimeout( function(){compare(ev,ob);} , cfg.interval );}

			// else e.type == "onmouseout"
			} else {
				// unbind expensive mousemove event
				$(ob).unbind("mousemove",track);
				// if hoverIntent state is true, then call the mouseOut function after the specified delay
				if (ob.hoverIntent_s == 1) { ob.hoverIntent_t = setTimeout( function(){delay(ev,ob);} , cfg.timeout );}
			}
		};

		// bind the function to the two event listeners
		return this.mouseover(handleHover).mouseout(handleHover);
	};
})(jQuery);

(function($) {
  
  var addMethods = function(source) {
    var ancestor   = this.superclass && this.superclass.prototype;
    var properties = $.keys(source);

    if (!$.keys({ toString: true }).length) properties.push("toString", "valueOf");

    for (var i = 0, length = properties.length; i < length; i++) {
      var property = properties[i], value = source[property];
      if (ancestor && $.isFunction(value) && $.argumentNames(value)[0] == "$super") {
        
        var method = value, value = $.extend($.wrap((function(m) {
          return function() { return ancestor[m].apply(this, arguments) };
        })(property), method), {
          valueOf:  function() { return method },
          toString: function() { return method.toString() }
        });
      }
      this.prototype[property] = value;
    }

    return this;
  }
  
  $.extend({
    keys: function(obj) {
      var keys = [];
      for (var key in obj) keys.push(key);
      return keys;
    },

    argumentNames: function(func) {
      var names = func.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(/, ?/);
      return names.length == 1 && !names[0] ? [] : names;
    },

    bind: function(func, scope) {
      return function() {
        return func.apply(scope, $.makeArray(arguments));
      }
    },

    wrap: function(func, wrapper) {
      var __method = func;
      return function() {
        return wrapper.apply(this, [$.bind(__method, this)].concat($.makeArray(arguments)));
      }
    },
    
    klass: function() {
      var parent = null, properties = $.makeArray(arguments);
      if ($.isFunction(properties[0])) parent = properties.shift();

      var klass = function() { 
        this.initialize.apply(this, arguments);
      };

      klass.superclass = parent;
      klass.subclasses = [];
      klass.addMethods = addMethods;

      if (parent) {
        var subclass = function() { };
        subclass.prototype = parent.prototype;
        klass.prototype = new subclass;
        parent.subclasses.push(klass);
      }

      for (var i = 0; i < properties.length; i++)
        klass.addMethods(properties[i]);

      if (!klass.prototype.initialize)
        klass.prototype.initialize = function() {};

      klass.prototype.constructor = klass;

      return klass;
    }//,
    // delegate: function(rules) {
    //   return function(e) {
    //     var target = $(e.target), parent = null;
    //     for (var selector in rules) {
    //       if (target.is(selector) || ((parent = target.parents(selector)) && parent.length > 0)) {
    //         return rules[selector].apply(this, [parent || target].concat($.makeArray(arguments)));
    //       }
    //       parent = null;
    //     }
    //   }
    // }
  });
  
  var bindEvents = function(instance) {
    for (var member in instance) {
      if (member.match(/^on(.+)/) && typeof instance[member] == 'function') {
        instance.element.bind(RegExp.$1, $.bind(instance[member], instance));
      }
    }
  }
  
  var behaviorWrapper = function(behavior) {
    return $.klass(behavior, {
      initialize: function($super, element, args) {
        this.element = $(element);
        if ($super) $super.apply(this, args);
      }
    });
  }
  
  var attachBehavior = function(el, behavior, args) {
      var wrapper = behaviorWrapper(behavior);
      instance = new wrapper(el, args);

      bindEvents(instance);

      if (!behavior.instances) behavior.instances = [];

      behavior.instances.push(instance);
      
      return instance;
  };
  
  
  $.fn.extend({
    attach: function() {
      var args = $.makeArray(arguments), behavior = args.shift();
      
      if ($.livequery && this.selector) {
        return this.livequery(function() {
          attachBehavior(this, behavior, args);
        });
      } else {
        return this.each(function() {
          attachBehavior(this, behavior, args);
        });
      }
    },
    attachAndReturn: function() {
      var args = $.makeArray(arguments), behavior = args.shift();
      
      return $.map(this, function(el) {
        return attachBehavior(el, behavior, args);
      });
    },
    // delegate: function(type, rules) {
    //   return this.bind(type, $.delegate(rules));
    // },
    attached: function(behavior) {
      var instances = [];
      
      if (!behavior.instances) return instances;
      
      this.each(function(i, element) {
        $.each(behavior.instances, function(i, instance) {
          if (instance.element.get(0) == element) instances.push(instance);
        });
      });
      
      return instances;
    },
    firstAttached: function(behavior) {
      return this.attached(behavior)[0];
    }
  });
  
  Remote = $.klass({
    initialize: function(options) {
      if (this.element.attr('nodeName') == 'FORM') this.element.attach(Remote.Form, options);
      else this.element.attach(Remote.Link, options);
    }
  });
  
  Remote.Base = $.klass({
    initialize : function(options) {
      this.options = $.extend({
        
      }, options || {});
    },
    _makeRequest : function(options) {
      $.ajax(options);
      return false;
    }
  });
  
  Remote.Link = $.klass(Remote.Base, {
    onclick: function() {
      var options = $.extend({ url: this.element.attr('href'), type: 'GET' }, this.options);
      return this._makeRequest(options);
    }
  });
  
  Remote.Form = $.klass(Remote.Base, {
    onclick: function(e) {
      var target = e.target;
      
      if ($.inArray(target.nodeName.toLowerCase(), ['input', 'button']) >= 0 && target.type.match(/submit|image/))
        this._submitButton = target;
    },
    onsubmit: function() {
      var data = this.element.serializeArray();
      
      if (this._submitButton) data.push({ name: this._submitButton.name, value: this._submitButton.value });
      
      var options = $.extend({
        url : this.element.attr('action'),
        type : this.element.attr('method') || 'GET',
        data : data
      }, this.options);
      
      this._makeRequest(options);
      
      return false;
    }
  });
  
  $.ajaxSetup({ 
    beforeSend: function(xhr) {
      xhr.setRequestHeader("Accept", "text/javascript, text/html, application/xml, text/xml, */*");
    } 
  });
  
})(jQuery);

/**
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

/**
 * Create a cookie with the given name and value and other optional parameters.
 *
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Set the value of a cookie.
 * @example $.cookie('the_cookie', 'the_value', { expires: 7, path: '/', domain: 'jquery.com', secure: true });
 * @desc Create a cookie with all available options.
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Create a session cookie.
 * @example $.cookie('the_cookie', null);
 * @desc Delete a cookie by passing null as value. Keep in mind that you have to use the same path and domain
 *       used when the cookie was set.
 *
 * @param String name The name of the cookie.
 * @param String value The value of the cookie.
 * @param Object options An object literal containing key/value pairs to provide optional cookie attributes.
 * @option Number|Date expires Either an integer specifying the expiration date from now on in days or a Date object.
 *                             If a negative value is specified (e.g. a date in the past), the cookie will be deleted.
 *                             If set to null or omitted, the cookie will be a session cookie and will not be retained
 *                             when the the browser exits.
 * @option String path The value of the path atribute of the cookie (default: path of page that created the cookie).
 * @option String domain The value of the domain attribute of the cookie (default: domain of page that created the cookie).
 * @option Boolean secure If true, the secure attribute of the cookie will be set and the cookie transmission will
 *                        require a secure protocol (like HTTPS).
 * @type undefined
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */

/**
 * Get the value of a cookie with the given name.
 *
 * @example $.cookie('the_cookie');
 * @desc Get the value of a cookie.
 *
 * @param String name The name of the cookie.
 * @return The value of the cookie.
 * @type String
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */
jQuery.cookie = function(name, value, options) {
    if (typeof value != 'undefined') { // name and value given, set cookie
        options = options || {};
        if (value === null) {
            value = '';
            options = $.extend({}, options); // clone object since it's unexpected behavior if the expired property were changed
            options.expires = -1;
        }
        var expires = '';
        if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
            var date;
            if (typeof options.expires == 'number') {
                date = new Date();
                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
            } else {
                date = options.expires;
            }
            expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
        }
        // NOTE Needed to parenthesize options.path and options.domain
        // in the following expressions, otherwise they evaluate to undefined
        // in the packed version for some reason...
        var path = options.path ? '; path=' + (options.path) : '';
        var domain = options.domain ? '; domain=' + (options.domain) : '';
        var secure = options.secure ? '; secure' : '';
        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
    } else { // only name given, get cookie
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
};

// AjaxQueue - by Pat Nakajima
(function($) {
  var startNextRequest = function() {
    if ($.ajaxQueue.currentRequest) { return; }
    if (request = $.ajaxQueue.queue.shift()) {
      $.ajaxQueue.currentRequest = request;
      request.perform();
    }
  }
  
  var Request = function(url, type, options) {
    this.opts = options || { };
    this.opts.url = url;
    this.opts.type = type;
    var oldComplete = this.opts.complete || function() { }
    this.opts.complete = function(response) {
      oldComplete(response);
      $.ajaxQueue.currentRequest = null;
      startNextRequest();
    };
  }
  
  Request.prototype.perform = function() {
    $.ajax(this.opts);
  }
  
  var addRequest = function(url, type, options) {
    var request = new Request(url, type, options);
    $.ajaxQueue.queue.push(request);
    startNextRequest();
  }
  
  $.ajaxQueue = {
    queue: [],
    
    currentRequest: null,
    
    reset: function() {
      $.ajaxQueue.queue = [];
      $.ajaxQueue.currentRequest = null;
    },
    
    post: function(url, options) {
      addRequest(url, 'POST', options);
    },
    
    get: function(url, options) {
      addRequest(url, 'GET', options);
    },
    
    put: function(url, options) {
      addRequest(url, 'PUT', options);
    },
    
    "delete": function(url, options) {
      addRequest(url, 'DELETE', options);
    }
  }
})(jQuery)

;(function($) {
  
  function ie6hack(code) {
    if ($.browser.msie && $.browser.version < 7) {
      code()
    }
  }
  
  var element = $("<div class='overlay'></div>").css({
    display: "none"
  })
  
  ie6hack(function() {
    element.append("<iframe border='none' src='/misc/iframe.html' style='overflow: hidden; filter=Alpha(opacity=0); height: 100%; width: 100%; border: none;'></iframe>")
  })
  
  $(function() {
    element.appendTo($(document.body));
  })

  var defaults = {
    opacity: 0.3,
    showSpeed: 'fast',
    callback: function() {}
  }
  $.overlay = function(params) {	
    var options = typeof params == 'function' ? $.extend({}, defaults, {callback: params}) : $.extend({}, defaults, params)	
    var html = $(document.documentElement)

    var overlay = {
      click: function(callback) {
        element.click(callback)
      },
      hide: function(hideCallback) {
        element.unbind('click')
        element.fadeOut('slow', 'linear').queue(function() {
          element.hide()
          if (hideCallback) {
              hideCallback()
          }
          $(this).dequeue()
        })
      }
    }

    if (!element.is(":visible")) {
      element.height($(document).height())
      element.show()
             .css('opacity', 0)
             .animate({opacity: options.opacity}, options.showSpeed, 'easeOutQuad')
             .queue(function() {
               options.callback(overlay)        
               $(this).dequeue()
             })
    }
    return overlay
  }
})(jQuery)


$(function() {

  var dialog = {
    open: function(params) {
      dialog.width = params.width
      dialog.height = params.height
      dialog.onClose = params.close || $noop
      dialog.flyIn = params.flyIn || function(el) {
        el.hide().queue(function() {
          $(this).fadeIn('slow').dequeue()
        })
      }
      dialog.flyOut = params.flyOut || function(el) {
        el.fadeOut('fast')
      }

      if (!dialog.element) {
        dialog.element = $("<div class='dialog'>" +
                             "<div class='dialog-header bgh-dialog-header'>" +
                               "<div class='close theme-close'></div>" +
                               "<div class='dialog-title'>" + params.title + "</div></div>" +
                             "<div class='content'></div>" +
                           "</div>")
        dialog.content = dialog.element.find('.content')
        if (dialog.width) {
          dialog.element.css('width', dialog.width + 'px')
          dialog.content.css('width', (dialog.width - 10 - 10) + 'px')
        }
        if (dialog.height) {
          dialog.element.css('height', dialog.height + 'px')
          dialog.content.css('height', (dialog.height - 29 - 10 - 10) + 'px')     
        }
        dialog.content.css('padding', '10px')

        dialog.element.find('.close').click(function() { dialog.close() })
        dialog.loading(true)
        $.overlay(function(overlay) {
          dialog.element.appendTo($(document.body))
          dialog.ie6frame()
          overlay.click(function() {
            dialog.close()
          })      
          dialog.flyIn(dialog.element)      
        })
        
        $(document).keyup(dialog.onkeyup)

        params.init && params.init(dialog)
      }
    },
    ie6frame: function(showing) {
      $('iframe', dialog.element).css({
        height: $(dialog.element).outerHeight(),
        width: $(dialog.element).outerWidth()
      })
    },
    title: function(value) {
      dialog.element.find(".dialog-title").html(value)
    },
    onkeyup: function(e) {
      if (e.which == 27) dialog.close() // escape
    },
    close: function(callback) {
      if (!dialog.element) return
      dialog.onClose && dialog.onClose(dialog)
      var element = dialog.element
      element.find('.close').unbind('click')
      dialog.flyOut(element)
      element.queue(function() {
        element.unload().unbind('unload').remove()
        $.overlay().hide(function() {
          callback && callback()
        })
        $(this).dequeue()
      })
      dialog.element = null
      $(document).unbind('keyup')
      return false;
    },
    center: function() {
      dialog.element.css({position: 'absolute'}).place(window, function(d, w) {
        d.Center.placeAt(w.Center)
      })
      
      dialog.ie6frame()
      return this;
    },
    loading: function(isLoading) {
      if (isLoading) {
        dialog.element.unload().unbind('unload')
        dialog.content.html('<div class="loading"></div>')
      } else {
        dialog.content.find('.loading').remove()
        
        var closeElement = dialog.content.find('a.close')
        closeElement.unbind('click')
        closeElement.click(function() { dialog.close() })
      }
    },
    loadHtml: function(html) {
      dialog.loading(true)
      dialog.content.html(html)
      dialog.loading(false)
    },
    loadContent: function(content) {
      dialog.loading(true)
      dialog.content.append(content.children())
      dialog.loading(false)
      dialog.element.unload(function() {
        content.append(dialog.content.children()) // move it back
      })
      return this;
    },
    loadAjax: function(url) {
      dialog.loading(true)
      $.get(url, {}, function(html) {
        dialog.loading(false)
        dialog.content.html(html)
      })
    }
  }

  $.dialog = function(params) {
    if (params) {
      dialog.open(params)
      if (params.element) {
        dialog.loadContent(params.element)
      } else if (params.ajax) {
        dialog.loadAjax(params.ajax)
      }
    }
    return dialog
  }

  $.fn.extend({
    dialog: function(params) {
      params["element"] = this
      return $.dialog(params)
    }
  });
})


var $bind = function(fun, obj) {
  return function() {
    return fun.apply(obj, arguments)
  }
}

var $noop = function() {}

$.fn.extend({  
  absolutePosition: function() {
    var offset = this.offset()
    return {
      top: offset.top + $(window).scrollTop(),
      left: offset.left,
      height: this.outerHeight(),
      width: this.outerWidth()
    }
  },

  cloak: function() {
    return $(this).toggleClass('invisible', true)
  },

  uncloak: function() {
    return $(this).toggleClass('invisible', false)
  }
})

$.scrollBy = function(delta) {
  var windowScroll = window.scrollY ? window.scrollY : document.documentElement.scrollTop
  if ($.support.opacity) {
    $(document.body).animate({display: 'block'}, {
      duration: 'fast',
      easing: 'easeOutExpo',
      step: function(prop, anim) {
        window.scrollTo(0, windowScroll + anim.pos * delta)
      },
      complete: function() {
        log.debug('finished')
        window.scrollTo(0, windowScroll + delta)
      }
    })
  } else {
    window.scrollTo(0, windowScroll + delta)
  }
}

$.findOne = function(array, callback) {
  for (var i = 0, length = array.length; i < length; i++) {
    if (callback(array[i])) return array[i];
  }
  return null;
}
$.contains = function(array, value) {
  for (var i = 0, length = array.length; i < length; i++) {
    if (array[i] == value) return true
  }
  return false;
}

$.ie6hack = function(code) {
	if ($.browser.msie && $.browser.version < 7) {
		code.call(this)
  }
}

$.ie7hack = function(code) {
  if ($.browser.msie && $.browser.version >= 7 && $.browser.version < 8) {
    code.call(this)
  }
}

$.iehack = function(code, otherwise) {
  if ($.browser.msie) {
    code.call(this, $.browser.version)
  } else if (otherwise) {
    otherwise.call(this)
  }
}
$.userAgentInfo = (function() {
  var ua = "unknown"
  $.each($.browser, function(name) {
    if (this == true) {
      ua = name
    }
  })
  if (ua != "unknown") {
    ua = [ua,$.browser.version].join(' ')
  }
  return ua
})()

$.fn.extend({
	ie6hack: function(code) {
		return $(this).each(function() {
			$.ie6hack.call(this, code)
		})
	},
	ie7hack: function(code) {
	  return $(this).each(function() {
	    $.ie7hack.call(this, code)
	  })
	}
})

var $discovery = {}

function goto(href) {
  window.goto = function() {
	return false
  }
  $leavingSite = false
  document.location = href
  return true
}

function jump(target) {
  $.overlay({
    showSpeed: 0,
    opacity: 0.2,
    callback: function() {
      $updating()
      goto(target)
    }
  })
}

$summon = window.$summon || {}
$summon.dialog = {}

$(function() {
	$('.SummonDialog').each(function() {
		var id = this.id
		$summon.dialog[this.id] = function(options) {
			return $.dialog($.extend({element: $('#' + id).parent()}, options))
		}
	})

  var isYearValid = function(year) {
    var val = year.val() || ''
    var validFormat = val.match(/^\d{4}/)
    var numeric = new Number(val)
    var valid = $.trim(val) == '' || (validFormat && !isNaN(numeric) && numeric >= 1 && numeric <= 2020)
    year.toggleClass('invalid', !valid)
    return valid
  }
  var buildDate = function(year, month, day) {
    if (year && year.length > 0) {
      var date = [year];
      if (month && month.length > 0) {
        date.push(month);
        if (day && day.length > 0) {
          date.push(day);
        }
      }
      return date.join('-')
    } else {
      return '*'
    }
  }
  $('.date-entry').each(function() {
    var element = $(this);
    var min = element.find('.min'), max = element.find('.max'), 
        range = element.find('.range'), error = element.find('.error');
    
    var updateDateRange = function() {
      if (!isYearValid(min.find('.year')) || !isYearValid(max.find('.year'))) {
        error.html($translate('Enter a valid year')) 
        //error.html('Enter a valid year')
        element.addClass('invalid').change()
        return;
      }
      minValue = buildDate(min.find('.year').val(), min.find('.month').val(), min.find('.day').val());
      maxValue = buildDate(max.find('.year').val(), max.find('.month').val(), max.find('.day').val());

      var rangeValue = "PublicationDate," + minValue + ":" + maxValue;
      if (rangeValue != range.val() || element.hasClass('invalid')) {
        range.val(rangeValue)
        var valid = minValue == '*' || maxValue == '*' || maxValue >= minValue
        error.html(valid ? '' : $translate('Enter a valid date range'))
        element.toggleClass('invalid', !valid).change()
      }
    }
    element.find('input,select').change(updateDateRange).keypress(function() {setTimeout(updateDateRange, 0)})
    updateDateRange()
  })
})

$.isEmpty = function(obj) {
	if ((typeof obj) == "string")
		return (obj.length == 0)
	else
		return $.isEmptyObject(obj)
}

$template = function(template, replacements) {
  var r, rex
  for (r in replacements) {
    template = template.replace(new RegExp('\{\{' + r + '\}\}', 'g'), replacements[r])
  }
  return template;
}

$translate = function(key) {
  if (!$translate.lang) $translate.setLang($('html').attr('lang'))
  return window[$translate.lang][key] || key 
}
$translate.setLang = function(lang) {
  $translate.lang = lang.replace('-', '_')
}
T = $translate;

if (window.Touch) {
  $(function() {

    var dock = $('#dock-container')
    var moving = false  
  
    function hide() {
      dock.hide()
    }
  
    function show() {
      try {
        var w = $(window),
            scrollTop = w.scrollTop(),
            height = w.height()
          
        dock.css({
          position: 'absolute',
          top: height + scrollTop - dock.height()
        }).fadeIn()
      
      } catch(e) {}
    }
  
    $(document).bind({
      touchstart: function(e) {
        hide()
      },
      touchend: function(e) {
        if (!moving) show()
      },
      touchmove: function(e) {
        if (!moving) {
          moving = true
          hide()
        }
      },
      scroll: function(e) {
        if (moving) {
          moving = false
          show()
        }
      }
    })

    $(window).bind('load orientationchange', function(e) {
      setTimeout(show, 100)
    })

    hide()
    $('body').addClass('touch')

  })
}


;$(function() {
  var current = null

  var Preview = $.klass({
    initialize: function() {
      this.design = this.element.hasClass('design')
      if (this.design) {
        this.element.css({display: 'block', position: 'static'})
      }
      var over = $bind(this.over, this),
          reset = $bind(this.reset, this),
          leave = $bind(this.leave, this),
          close = $bind(this.hide, this)
      this.element.find('.close').click(close)
      this.element.find('.titleBar .button').hover($bind(this.tabActive, this), $bind(this.tabInactive, this))
      this.docid = this.element.attr('docid')
      this.back = this.element.find('.titleBar .back .button').click(reset)
      this.main = this.element.find('.main')

      this.visible = false
      this.triggered = false
      this.hovering = false

      this.pointerUp = this.element.find('.preview-pointer-up')
      this.pointerDown = this.element.find('.preview-pointer-down')

      this.content = this.summary = this.element.find('.main .summary')

      this.element.hover(over, leave)
    },
    show: function(tool) {
      if (this.current == tool) return
      this.current = tool
      this.back.toggleClass('hidden', false)
      this.swap(this.content, tool.content, $bind(tool.activate, tool))
    },
    reset: function() {
      this.swap(this.content, this.summary, $noop)
      this.back.toggleClass('hidden', 'true')
      this.current = null
    },
    swap: function(old, next, callback) {
      this.content = next
      old.fadeOut('fast').queue(function() {
        next.fadeIn('fast').queue(function() {
          $(this).dequeue()
          if (callback) {
            callback(next)
          }
        })
        $(this).dequeue()
      })
    },
    hidePreviewArrows: function() {
      $(this.pointerUp).hide()
      $(this.pointerDown).hide()
    },
    displayPreviewArrow: function(event, top, left) {
      var trigger = $(event.target)
      var triggerTop = trigger.offset().top + $(window).scrollTop()
      var pointer = this.pointerDown
      if (triggerTop < top) {
        pointer = this.pointerUp
      }

      var adjustment = 0
      if ($(trigger).is('.show-preview-button')) {
        adjustment = $(pointer).width() / 2 - $(trigger).width() / 2
      }

      var localOffSet = $(trigger).offset().left - $(this.element).offset().left - adjustment
      pointer.css("left", localOffSet + "px").show()
    },
    movePreviewArrow: function(event, top, left) {
      var trigger = $(event.target)
      var triggerTop = trigger.offset().top
      var pointer = this.pointerDown
      if (triggerTop < top) {
        pointer = this.pointerUp
      }

      var adjustment = 0
      if ($(trigger).is('.show-preview-button')) {
        adjustment = $(pointer).width() / 2 - $(trigger).width() / 2
      }

      var localOffSet = $(trigger).offset().left - $(this.element).offset().left - adjustment
      pointer.animate({ left: localOffSet }, { duration: 500, easing: 'easeOutExpo' })
    },
    over: function(event) {
      this.hovering = true
    },
    leave: function() {
      this.hovering = false
      this.delayHide()
    },
    ping: function() { // keepalive
      if (this.visible) {
        this.triggered = true
        this.clearDelayedHide()
      }
    },
    toggle: function(event) {
      if (this.visible) {
        this.hide(event)
      }
      else {
        this.raise(event)
      }
    },
    raise: function(event) {
      this.triggered = true
      this.visible = true
      this.clearDelayedHide()
      var trigger = $(event.target)
      var padding = (this.element.outerWidth() - this.element.width()) / 2

      if (current != this) {
        this.hidePreviewArrows()
        $hideCurrentPreview()
        current = this
        this.element.css({
          left: this.left(trigger, padding),
          top: this.top(trigger, 0)
        }).fadeIn('slow').trigger('show')
        this.displayPreviewArrow(event, this.top(trigger, 0), this.left(trigger, padding / 2))
      }
      else if (current != null) {
        var moveArrow = function() { this.movePreviewArrow(event, this.top(trigger, 0), this.left(trigger, padding / 2)) }
        this.element.animate({
          left: this.left(trigger, padding),
          top: this.top(trigger, 0)
        }, {
          duration: 250,
          easing: 'easeOutExpo',
          complete: $bind(moveArrow, this)
        })
      }
    },
    hide: function() {
      this.clearDelayedHide()
      this.visible = false
      this.triggered = false
      this.hovering = false
      if (!this.design) {
        this.element.fadeOut('fast')
      }
      current = null
    },
    delayHide: function() {
      this.triggered = false
      this.clearDelayedHide()
      this.setDelayedHide()
    },
    hideUntriggered: function() {
      this.clearDelayedHide()
      if (this.triggered || this.hovering) {
        // nothing
      }
      else {
        this.hide()
      }
    },
    setDelayedHide: function() {
      this.hideTimer = setTimeout($bind(this.hideUntriggered, this), 500)
    },
    clearDelayedHide: function() {
      clearTimeout(this.hideTimer)
    },
    top: function(trigger, padding) {
      var previewArrowHeight = 18
      var bound = $('#resultPage')
      var height = this.element.height()
      var scrollTop = $(window).scrollTop()
      var triggerTop = trigger.offset().top + scrollTop
      var top = triggerTop - height - padding
      if (top < scrollTop) {
        return triggerTop + trigger.height() - padding + previewArrowHeight
      } else {
        return top - previewArrowHeight
      }
    },
    left: function(trigger, padding) {
      var anchor = trigger.offset().left
      var width = this.element.width()
      var left = anchor - (width / 2)
      var overflowRight = this.overflowRight(left, width)
      var overflowLeft = this.overflowLeft(left, width)
      return left + overflowLeft - overflowRight - padding
    },
    overflowRight: function(left, width) {
      var bound = $('#page')
      var boundright = bound.offset().left + bound.width()
      return Math.max(0, left + width - boundright + 5)
    },
    overflowLeft: function(left) {
      var bound = $('#resultPage')
      return Math.max(0, bound.offset().left - left + 5)
    },
    tabActive: function(e) {
      this.active($(e.target), true)
    },
    tabInactive: function(e) {
      this.active($(e.target), false)
    },
    active: function(el, state) {
      var type = 'theme-preview-button-' + el.attr('type')
      el.toggleClass(type + "-active", state)
    }
  })


  $('.preview').attach(Preview)

  //noinspection JSUndeclaredVariable
  $hideCurrentPreview = function() {
    if (current) {
      current.hide()
    }
  }
  $hidePreview = function(previewElement, event) {
    if (previewElement && previewElement.length) {
      var preview = previewElement.firstAttached(Preview)
      preview.delayHide()
    }
  }
  $togglePreview = function(previewElement, event) {
    if (previewElement && previewElement.length) {
      var preview = previewElement.firstAttached(Preview)
      preview.toggle(event)
    }
  }
  $pingPreview = function(previewElement, event) {
    if (previewElement && previewElement.length) {
      var preview = previewElement.firstAttached(Preview)
      preview.ping()
    }
  }
  $preview = function(previewElement, event) {
    if (previewElement && previewElement.length) {
      var preview = previewElement.firstAttached(Preview)
      preview.raise(event)
    }
  }
})


$.fn.places.NAMES = {
  C:  'Center',
  N:  'North',
  NE: 'NorthEast',
  E:  'East',
  SE: 'SouthEast',
  S:  'South',
  SW: 'SouthWest',
  W:  'West',
  NW: 'NorthWest'
}